<html>

<head>
  <title>Tasks Manager Dashboard</title>
  <script src="../libs/babel.min.js"> //URL
    /* https://unpkg.com/@babel/standalone/babel.min.js */
  </script>
  <script> window.process = { env: { NODE_ENV: 'development' } }</script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js">
    globalThis.React = React;
  </script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js">
    globalThis.ReactDOM = ReactDOM;
  </script>
  <script src="../libs/d3.v7.js">
    globalThis.d3 = d3;
  </script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.14.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/jquery-3.7.1.js">
    globalThis.$ = $;
  </script>
  <script src="https://code.jquery.com/ui/1.14.1/jquery-ui.js">
    $(() => { $(".resizable").resizable() });
  </script>
  <script src="private/credentials.js"></script>
  <script>
    function hideMap() {
      console.log("Hiding map");
      document.getElementById("map").style.display = "none";
    }
    function assignHrefVarName(href, varName) {
      const varTmp = href.substring(href.search(`${varName}=`) === -1 ? 0 :
        (href.search(`${varName}=`) + varName.length + 1));
      const varNameResult = varTmp === href ? href :
        varTmp.substring(0, varTmp.search("&") === -1 ? varTmp.length :
          varTmp.search("&"));
      if (!varNameResult.length || varNameResult.substring(0,8) === "file:///") {
        console.error(`At least ${varName} was missing via href`);
        return false;
      }
      return varNameResult;
    }
    function handleCredentials() {
      const credentials_list = [
        "birthday",
        "daily_growth",
        "monday_key",
        "offset_at_1900"
      ];
      const loaded_credentials = credentials_list.map(credential => {
        if (!window[credential] || !window[credential].length) {
          /*console.error(
            `At least ${credential} was missing via private folder`
          );*/
          return false;
        }
        return true;
      });
      if (!loaded_credentials.filter(credential => !credential).length) {
        console.log("Credentials loaded via private folder");
        return;
      }
      const url = window.location.href;
      const href = url.substring(url.indexOf("#") + 1);
      credentials_list.filter(
          credential => !!assignHrefVarName(href, credential)
        ).map(
          credential =>
            window[credential] = assignHrefVarName(href, credential)
        );
      console.log("Credentials done loading via href");
    }
    handleCredentials();
  </script>
  <!--
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.103/Build/Cesium/Cesium.js"></script>
  <link href="../style/cesium-widgets-1.103.css" rel="stylesheet">
  -->
  <link href="../style/style.css" rel="stylesheet">
  <link rel="shortcut icon" type="image/x-icon" href="../public/real-estate-investing-management.ico">
  <style>
    a, b, body, fieldset, legend, span, table, td { font-size: 0.88em; }
    /*
    path.slice { stroke-width: 2px; }
    polyline { fill: none; opacity: 0.3; stroke-width: 2px; stroke: #000; }
    */
    svg { font-weight: bold !important; /*width: 100%; height: 100%;*/ }
    .b-1-s-grey { border: 1px solid #6666; }
    .hw-100p-2em {
      height: calc(100% - 2em);
      width: calc(100% - 2em);
    }
    .hw-800-1080 {
      width: min(calc(100% - 0.5em), 1080px);
      height: min(calc(100% - 1.5em), 800px);
    }
    .pa { position: absolute; }
    .pt-05em { padding-top: 0.5em; }
  </style>
</head>

<body class="flex-container-2 hw-100p-2em pt-05em">
  <div class="sidebar">Sidebar</div>
  <div class="flex-container-2 b-1-s-grey" style="width: calc(100% - 3em);">
    <div id="taskManager" class="hw-800-1080 pt-05em"></div>
    <div id="monto" class="grid-container-2">
      <div>
        <div class="bordered">Assets<span id="dailyGrowth"></span>:<br>
          <span id="amountEur">___.___,__ ‚Ç¨</span>&nbsp;<br>
          <!--<span id="amountDkk">_.___.___,__ DKK</span>&nbsp;<br>-->
          Passive<span id="monthlyPassGrowth"></span>:<br>
          &nbsp;&nbsp;<span id="amountEurPas">_.___,_____ ‚Ç¨</span>&nbsp;<br>
          <div style="height:0.3em"></div>
        </div>
        <div class="bordered" style="display:none">Started at:<br>
          <span id="startRegr"></span>
        </div>
      </div>
      <div class="bordered" style="display:none">
        Next milestone:<br>
        &nbsp;<small>&nbsp;</small><input id="amntEurMs" type="number" value="1750" style="width:6em"
          onchange="handleMilestoneAmount(this.value)" class="bordered"></input><br>
        <span class="after-input"><span id="dateEurMs"></span><br>
          in <span id="yearsMs"></span> y, at <span id="yearsSelfMs"></span> yo,<br>
          equals <span id="adjustedAmount"></span>&nbsp;</span>
      </div>
    </div>
    <!-- tasks by category and day unneeded placeholder and calendar
    <div id="tasksByCategoryAndDay"></div>
    <div id="calendar" style="width:min(99vw, 648px); height:min(calc(100% - 1.5em), 800px); position:relative;">
      <iframe id="calendarIframe" class="zoom-out-iframe" style="margin-top: 1em"></iframe>
    </div>-->
  </div>
  <div id="popUpDiv" class="pa" style="width: 2.6em; height: 1.2em; right: 5em; top: 0.8em;"></div>
  <script> // Calendar iframe
    const calendarSrc = `https://calendar.google.com/calendar/embed?
				bgcolor=%23000000
				&color=%23000000
				&ctz=Europe%2FCopenhagen
				&height=860
				&mode=WEEK
				&showNav=1
				&showCalendars=0&showPrint=0&showTabs=0&showTitle=0&showTz=0
				&src=MW9vMWliZ2RmbWtuYzBkMWVobWhkZTg3cnNAZ3JvdXAuY2FsZW5kYXIuZ29vZ2xlLmNvbQ
				&wkst=${(new Date().getDay() + 1).toString()}`;
    const calendarIframe = document.getElementById("calendarIframe");
    if (calendarIframe) {
      calendarIframe.src = calendarSrc;
    }
    /*setTimeout(() => {
      // Hide calendar hours before 6 AM
      console.log("yAxis", document.getElementsByClassName("tg-times-pri")[0]);
      const yAxisHours = Array.from(document.getElementsByClassName("tg-times-pri")[0].children)
        .filter((v, i) => (i <= 6 && i >= 22)).map(v => v.style.display = "none");
      const cellHours = Array.from(document.getElementsByClassName("tg-hourmarkers")[0].children)
        .filter((v, i) => (i <= 6 && i >= 22)).map(v => v.style.display = "none");
    }, 3000);*/
  </script>
  <script src="../assets/tasksManager.js"></script>
  <script src="../assets/tasksManager.jsx"></script>
  <script type="text/babel"> // SideBar
    const urlPrefixPos = location.href.search("/pages/");
    const urlPrefix = location.href.substring(0, urlPrefixPos);
    const sideBarDom = document.getElementsByClassName('sidebar')[0];
    const sideBarRoot = globalThis.ReactDOM.createRoot(sideBarDom);
    const sideBarPages = [{
      name: "CV",
      location: "index",
      img: "cv"
    }, {
      name: "Tasks dashboard",
      location: "pages/tasksDashboard",
      img: "prioritize"
    }, {
      name: "Music",
      location: "pages/music",
      img: "music"
    }, {
      name: "Navezgane map",
      location: "pages/navezgane",
      img: "zombie"
    }, {
      name: "The three seas map",
      location: "pages/theThreeSeas",
      img: "map"
    }];
    sideBarRoot.render(
      <div className="space-children-01em">
        {
          sideBarPages.map(p => (
            <a key={`${p.img}A`} href={`#${p.name}`}
              onClick={() => document.location = `${urlPrefix}/${p.location}.html`}
            >
              <img key={`${p.img}Img`}
                src={`../public/${p.img}.png`}
                className={location.href === `${urlPrefix}/${p.location}.html` ? "highlight-active" : ""}
              />
            </a>
          ))
        }
      </div>
    )
  </script>
  <!-- SideBar handler and Cesium map
  <script type="text/babel" src="../assets/sideBarHandler.jsx"></script>
  <div id="map" style="width:min(99vw, 600px); height:calc(100% - 1em); position:relative">
    <button class="close-button" onClick='hideMap()'>
      &times; <span style="display:none">üëÅ</span>
    </button>
  </div>
  <script src="../assets/cesiumInit.js"></script>
  -->
  <script>
    const milliSecondsPerDay = 24 * 60 * 60 * 1000;
    const daysBetween1900and1970 = 25569;
    const numberFormat = {
      currency: "EUR",
      maximumSignificantDigits: 9,
      style: "currency",
      useGrouping: true
    };
    const passiveFactor = 0.0673;
    const interval = 200;
    const amountEurDomObj = document.getElementById("amountEur"); // as HTMLSpanElement;
    const amountEurPasDom = document.getElementById("amountEurPas"); // as HTMLSpanElement;
    const dailyGrowthDom = document.getElementById("dailyGrowth");
    dailyGrowthDom.innerText = ` (${daily_growth}‚Ç¨/d)`;
    const monthlyPassGrowthDom = document.getElementById("monthlyPassGrowth");
    const monthlyPassGrowth = 30 * daily_growth * (passiveFactor / 12);
    monthlyPassGrowthDom.innerText = ` (${monthlyPassGrowth.toPrecision(3)}p‚Ç¨/m)`;
    let exec = false;
    setInterval(
      () => {
        if(!exec) {
          const montoDom = document.getElementById("monto");
          const fireGoal = document.getElementById("fireGoal");
          fireGoal.appendChild(montoDom);
          exec = true;
        }
        const currentAmount = (daily_growth * (
          ((new Date().getTime()) / milliSecondsPerDay) + daysBetween1900and1970
        ) + offset_at_1900);
        const currentAmountEur = new Intl.NumberFormat(
          'es-ES', numberFormat
        ).format(currentAmount);
        const amountEurPas = currentAmount * passiveFactor / 12;
        amountEurDomObj.innerText = currentAmountEur;
        amountEurPasDom.innerText = new Intl.NumberFormat(
          'es-ES', numberFormat
        ).format(amountEurPas);
      }, interval
    );
  </script>
</body>

</html>